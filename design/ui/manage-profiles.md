[â† Back to README](README.md)

# Manage Profiles {#manage-profiles}

<pre>

<a id="rename-user-flow"></a>
<a id="delete-user-flow"></a>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header (AppBar)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ <a href="./dashboard.md">â† Back</a>  Manage Profiles           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Active Profile Display                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Active Profile: Personal                          â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚ â„¹ï¸  All transactions are saved with the active    â”‚ â”‚
â”‚  â”‚    profile name. Profiles are stored locally.     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  Profiles List                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Profiles                                          â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚ [Import from Database]                       â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ (Auto-populates profiles from transactions)   â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â”‚ Personal                                      â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ [Active] [<a href="#rename-profile-modal">Rename</a>] [<a href="#delete-profile-modal">Delete</a>]                    â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ (delete disabled - active profile)            â”‚  â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â”‚ Business                                      â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ [Set as Active] [<a href="#rename-profile-modal">Rename</a>] [<a href="#delete-profile-modal">Delete</a>]             â”‚  â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â”‚ Family                                        â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ [Set as Active] [<a href="#rename-profile-modal">Rename</a>] [<a href="#delete-profile-modal">Delete</a>]             â”‚  â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  Create Profile Form                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Create New Profile                               â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚ Profile Name                                      â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚ [Enter profile name]                         â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚ Examples: Personal, Business, Family, Travel      â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚ Create Profile                                â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  Info Text                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â„¹ï¸  All transactions are saved with the active    â”‚ â”‚
â”‚  â”‚    profile name. Profiles are stored locally.     â”‚ â”‚
â”‚  â”‚    Switching profiles filters your transactions.  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  Empty State (when no profiles)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚        ğŸ‘¤                                          â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚  No profiles yet                                  â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚  Create your first profile to get started        â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>

## API Endpoints

<a id="api-endpoints"></a>

<a id="api-profile-management"></a>

### Profile Management
- Profile operations now derive everything from `/api/transactions`. The front-end scans transactions to count references, and uses `PUT /api/transactions/:id` to update rows when renaming profiles. There are no dedicated `/api/profiles/*` endpoints after the metadata removal work.

**Note:** Profile management operations (create, switch, delete) are performed client-side using IndexedDB. Renaming a profile still requires an API call to update transactions in the database, but deletion now relies solely on the preview APIâ€”if the preview shows zero affected transactions, the profile is removed locally with no further backend calls. The transactions API is also used for the "Import from Database" feature to extract profile names from existing transactions.

**Storage:** Profiles are stored locally in IndexedDB. Transactions are stored in PostgreSQL (Supabase) with profile names embedded in each transaction record. When a profile is renamed, both IndexedDB and all related transactions in the database are updated.

## Features

- **Active Profile Display**: Shows currently active profile prominently
- **Profile List**: Lists all profiles from IndexedDB
- **Switch Profile**: Set any profile as active (instant, no API calls)
- **Create Profile**: Add new profiles with unique names
- **Rename Profile**: Update profile name in IndexedDB and all transactions in database - [See Rename Modal](#rename-profile-modal)
- **Delete Profile**: Remove profile from IndexedDB only if no transactions use it (validated via preview only; no backend delete call) - [See Delete Modal](#delete-profile-modal)
- **Import from Database**: Scan transactions and auto-populate profiles
- **Profile Auto-Population**: Automatically runs at app startup if IndexedDB is empty

## Profile Auto-Population (Startup)

At app startup, if IndexedDB profiles are empty, the system automatically:

1. Fetches all transactions for the current user
2. Extracts unique profile names from transactions
3. Adds profiles to IndexedDB
4. Sets first profile as active (if no active profile exists)
5. Runs silently (no user notification needed)

This ensures users who have transactions but lost their IndexedDB data (e.g., cleared browser data) can continue using the app without manual setup.

## Import from Database

The "Import from Database" button allows manual profile import:

1. User clicks "Import from Database" button
2. System scans all transactions for the current user
3. Extracts unique profile names
4. Adds new profiles to IndexedDB (skips existing ones)
5. Shows success message (e.g., "Added 3 profiles, skipped 1 existing")
6. If no active profile exists, sets first imported profile as active

## User Flow

1. User navigates to Manage Profiles page
2. User sees list of all profiles with active profile highlighted
3. User can switch active profile (instant, reloads dashboard data)
4. User can create new profile (saved to IndexedDB)
5. User can rename profile (updates IndexedDB and all transactions in database) - [See Rename Modal](#rename-profile-modal)
6. User can delete profile (removes from IndexedDB, transactions remain) - [See Delete Modal](#delete-profile-modal)
7. User can import profiles from database (scans transactions)

## Error Handling

- **Duplicate names**: Prevents creating profiles with duplicate names
- **Active profile deletion**: Disabled for active profile (must switch first)
- **Validation**: Ensures profile name is not empty
- **Success feedback**: Shows success message after operations

## Component Structure

The Manage Profiles page consists of:

```
ManageProfiles
â”œâ”€â”€ Header (AppBar with back button)
â”œâ”€â”€ ActiveProfileDisplay (shows currently active profile name)
â”œâ”€â”€ ProfilesList
â”‚   â””â”€â”€ ProfileItem
â”‚       â”œâ”€â”€ ProfileName
â”‚       â”œâ”€â”€ SetActiveButton (if not current)
â”‚       â”œâ”€â”€ ActiveBadge (if current)
â”‚       â”œâ”€â”€ RenameButton
â”‚       â””â”€â”€ DeleteButton (disabled if active profile)
â”œâ”€â”€ CreateProfileForm
â”‚   â”œâ”€â”€ ProfileNameInput
â”‚   â””â”€â”€ CreateButton
â””â”€â”€ InfoText ("All transactions are saved with the active profile name. Profiles are stored locally.")
```

## Profile Management Flow

1. Dashboard â†’ Manage Profiles Button
2. Load Profiles List from IndexedDB â†’ Display Active Profile
3. User Actions:
   - **Switch Profile**: Select Profile â†’ Update active selection in IndexedDB settings â†’ Reload Dashboard with new profile filter
   - **Create Profile**: Enter Profile Name â†’ Save to IndexedDB â†’ 
     - No backend initialization needed (tags and transactions will be created with profile name when first used)
   - **Rename Profile**: Select Profile â†’ [Open Rename Modal](#rename-profile-modal) â†’ Enter New Name â†’ Query `/api/transactions?profile=<oldName>&limit=1` to show affected count â†’ When confirmed, stream `/api/transactions?profile=<oldName>` and call `PUT /api/transactions/:id` with the new profile name for each row â†’ Update the profile record in IndexedDB.
     - All transactions in PostgreSQL with old profile name are updated via the existing transactions endpoint.
   - **Delete Profile**: Select Profile (non-active) â†’ Query `/api/transactions?profile=<name>&limit=1` to confirm zero usage â†’ [Open Delete Modal](#delete-profile-modal) with count â†’ If profile is used, show error and block deletion â†’ If not used, Confirm â†’ Remove from IndexedDB.
     - Deletion is only allowed if no transactions contain the profile
4. Success Message

## Security Notes

- Profile management (create, switch) happens client-side (IndexedDB)
- Profile renaming requires API call to update database transactions
- Profile deletion happens entirely client-side after preview confirms there are no transactions referencing the profile
- Existing transactions in database are updated when renaming a profile
- Profile rename operations update all user's transactions that have the old profile name
- Profile delete operations permanently remove all user's transactions that have the profile name

---

## Rename Profile Modal

<a id="rename-profile-modal"></a>

### Visual Design

<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Rename Profile Modal (Dialog)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  Rename Profile                                  â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  Current Profile: Business                       â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  New Profile Name                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Business                                      â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  This will update 42 transactions.              â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  â„¹ï¸  All existing transactions with this profile â”‚ â”‚
â”‚  â”‚     will be updated to use the new name.         â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ <a href="#rename-user-flow">Cancel</a>     â”‚  â”‚ <a href="#rename-user-flow">Rename Profile</a>      â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>

### User Flow

1. User clicks "Rename" button on a profile item
2. Modal opens with current profile name pre-filled
3. User edits the profile name
4. User clicks "Rename Profile" button
5. System validates:
   - Name is not empty
   - Name is not duplicate of existing profile
   - Name is different from current name
6. If valid: 
   - Calls `GET /api/profiles/rename/preview` to get affected transaction count
   - Shows confirmation dialog: "This will update X transactions. Continue?"
   - User confirms â†’ Calls `POST /api/profiles/rename` to update all transactions in database
   - Updates profile name in IndexedDB
7. Modal closes
8. Profile list refreshes with updated name
9. Success message displayed: "Profile renamed successfully. X transactions updated."

### Validation Rules

- **Empty name**: Shows error "Profile name cannot be empty"
- **Duplicate name**: Shows error "A profile with this name already exists"
- **Same as current**: Shows error "New name must be different from current name"
- **Special characters**: Allowed (no restrictions)

### Component Structure

```
RenameProfileModal
â”œâ”€â”€ Dialog (Material-UI)
â”‚   â”œâ”€â”€ DialogTitle ("Rename Profile")
â”‚   â”œâ”€â”€ DialogContent
â”‚   â”‚   â”œâ”€â”€ CurrentProfileName (read-only display)
â”‚   â”‚   â”œâ”€â”€ TextField (profile name input)
â”‚   â”‚   â””â”€â”€ InfoText (warning about existing transactions)
â”‚   â””â”€â”€ DialogActions
â”‚       â”œâ”€â”€ CancelButton (closes modal)
â”‚       â””â”€â”€ RenameButton (validates and saves)
```

### Error Handling

- **Validation errors**: Displayed inline below input field
- **IndexedDB errors**: Shows error message "Failed to rename profile. Please try again."
- **API errors**: If database update fails, shows error "Failed to update profile in database. Please try again."
- **Network errors**: Shows error "Failed to rename profile. Please check your connection and try again."
- **Success feedback**: Toast notification "Profile renamed successfully. X transactions updated."

### Notes

- All existing transactions in PostgreSQL database with the old profile name are updated to use the new name
- Profile rename requires an API call to update the database
- The rename operation updates all transactions that have the old profile name
- If the renamed profile is currently active, the active profile name updates immediately in IndexedDB
- The API returns the count of transactions that were updated

---

## Delete Profile Modal

<a id="delete-profile-modal"></a>

### Visual Design

<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Delete Profile Modal (Dialog)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  âš ï¸  Delete Profile                              â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  Are you sure you want to delete this profile?   â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  Profile: Business                               â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  [If profile is used:]                            â”‚ â”‚
â”‚  â”‚  âŒ This profile is used in 42 transactions.   â”‚ â”‚
â”‚  â”‚     Deletion is not allowed.                      â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  [If profile is not used:]                       â”‚ â”‚
â”‚  â”‚  âœ“ No transactions use this profile.               â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  âš ï¸  Warning:                                    â”‚ â”‚
â”‚  â”‚  - This action cannot be undone                  â”‚ â”‚
â”‚  â”‚  - The profile will be removed from your list    â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ <a href="#delete-user-flow">Cancel</a>     â”‚  â”‚ <a href="#delete-user-flow">Delete Profile</a>        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>



### User Flow

1. User clicks "Delete" button on a profile item (disabled for active profile)
2. System calls `GET /api/profiles/delete/preview` to check if profile is used in transactions
3. If profile is used:
   - Modal opens showing error: "This profile is used in X transactions. Deletion is not allowed."
   - Delete button is disabled
   - User must delete or reassign all transactions before deletion is allowed
4. If profile is not used:
   - Modal opens with confirmation message
   - User reviews warning information
   - User clicks "Delete Profile" button to confirm
   - System validates:
     - Profile is not the currently active profile
     - Profile exists in IndexedDB
   - If valid:
     - Removes profile from IndexedDB (no backend delete request)
   - Modal closes
   - Profile list refreshes (deleted profile removed)
   - Success message displayed: "Profile deleted successfully."
5. If deleted profile was the only profile, shows empty state


### Validation Rules

- **Active profile**: Delete button is disabled (cannot delete active profile)
- **Non-existent profile**: Shows error "Profile not found"
- **Confirmation required**: User must explicitly click "Delete Profile" button

### Component Structure

```
DeleteProfileModal
â”œâ”€â”€ Dialog (Material-UI)
â”‚   â”œâ”€â”€ DialogTitle ("Delete Profile" with warning icon)
â”‚   â”œâ”€â”€ DialogContent
â”‚   â”‚   â”œâ”€â”€ ConfirmationText ("Are you sure...")
â”‚   â”‚   â”œâ”€â”€ ProfileName (profile to be deleted)
â”‚   â”‚   â””â”€â”€ WarningText (list of consequences)
â”‚   â””â”€â”€ DialogActions
â”‚       â”œâ”€â”€ CancelButton (closes modal)
â”‚       â””â”€â”€ DeleteButton (confirms and deletes)
```

### Error Handling

- **Active profile deletion attempt**: Button is disabled, no modal opens
- **Preview errors**: If preview API fails, shows error "Failed to check affected transactions. Please try again."
- **IndexedDB errors**: Shows error message "Failed to delete profile. Please try again."
- **Preview result (profile is in use)**: Shows error "Cannot delete profile: it is used in X transactions. Please delete or reassign all transactions before deleting the profile."
- **Network errors**: Shows error "Failed to delete profile. Please check your connection and try again."
- **Success feedback**: Toast notification "Profile deleted successfully."

### Notes

- Deletion is only allowed if no transactions contain the profile
- If any transactions use the profile, deletion is blocked with an error message
- The profile is removed from IndexedDB only after validation confirms no transactions use it
- If all profiles are deleted, user will see empty state and can create a new profile
- Delete operation relies solely on the preview API; once it reports zero transactions, removal happens locally
- Cannot delete the currently active profile (must switch to another profile first)
- The preview API validates that no transactions contain the profile before allowing deletion

